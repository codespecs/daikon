<html>
<head>
<TITLE>Using Daikon at MIT CSAIL</TITLE>
<link rev="made" href="mailto:mernst@csail.mit.edu">
</head>
<body>

<h1>Using Daikon at MIT CSAIL</h1>

<p>
This document tells you how to get started using Daikon on the PAG machines
(all named after root vegetables) at MIT CSAIL.
These steps are primarily for students and other colleagues working with
Michael Ernst; if you do not need access to the central repository of code
and data, you can simply <a href="../download/">download</a> the Daikon
distribution to your own computer.
</p>

<p>
The steps are simple, but there are many of them.  You
might wish to print this out (along with the <a
href="../download/doc/">Daikon manual</a>) and check off items as
you ensure that they are correct.
</p>

<p>
You should already be familiar with <a href="../">the Daikon homepage</a>
and <a href="../download/">the Daikon distribution</a>.  See the <a
href="../download/doc/daikon.html">Daikon manual</a> for more details.
</p>

<p>
If you work in the Program Analysis Group, then you should also be familiar
with the <a href="http://pag.csail.mit.edu/pag/logistics.html">logistics
for work at PAG</a>.
</p>

<p>
Contents:
<!-- start toc.  do not edit; run html-update-toc instead -->
    <ul>
      <li><a href="#getting-started">Getting started</a>
        <ul>
          <li><a href="#learning-about-daikon">Learning about Daikon</a>
          <li><a href="#pag-computers">PAG computers</a>
          <li><a href="#getting-daikon">Getting your copy of Daikon</a>
            <ul>
              <li><a href="#local-cvs">Local CVS</a>
              <li><a href="#remote-cvs">Remote CVS</a>
              <li><a href="#using-cvs">Using CVS</a>
            </ul>
          <li><a href="#environment">Notes on your environment</a>
        </ul>
      <li><a href="#scratch-directories">Large files and scratch directories</a>
      <li><a href="#editing-daikon">Editing Daikon source code</a>
        <ul>
          <li><a href="#Emacs-commands">Emacs commands</a>
          <li><a href="#editing-daikon.texinfo">Editing daikon.texinfo</a>
        </ul>
      <li><a href="#other-tasks">Other tasks</a>
        <ul>
          <li><a href="#regression-tests">Testing Daikon</a>
          <li><a href="#distribution">Making a distribution</a>
        </ul>
      <li><a href="#reporting">Reporting on your research</a>
    </ul>
<!-- end toc -->
</p>

<h2><a name="getting-started"></a>Getting started</h2>

<h3><a name="learning-about-daikon"></a>Learning about Daikon</h3>

<p>
In order to become familiar with the theory of dynamic invariant detection
and some details of the Daikon implementation, see the following <a
href="http://pag.csail.mit.edu/~mernst/research/#Invariant%20detection">papers</a>:
<ul>
  <li><a href="http://pag.csail.mit.edu/~mernst/pubs/invariants-tse2001-abstract.html">Dynamically
      Discovering Likely Program Invariants to Support Program
      Evolution</a> (IEEE TSE, v27#2, Feb 2001, pp 1-25)<br>
      I call this "the invariants paper" as it was the first exposition of
      the idea of dynamic invariant detection.  The first four and last
      three sections are more important than the middle four; you should
      skim or skip sections 5-8 on first reading.
  <li><a href="http://pag.csail.mit.edu/~mernst/pubs/invariants-relevance-icse2000-abstract.html">Quickly Detecting Relevant Program Invariants</a> (ICSE 2000)<br>
      I call this "the relevance paper"; it discusses essential
      improvements to the basic technique.
</ul>
There are additional papers that further discuss the technique and
its applications; which ones to read depends on your particular interest.
</p>


<h3><a name="pag-computers"></a>PAG computers</h3>

<p>
See the notes about <a
href="http://pag.csail.mit.edu/pag/logistics.html#pag-computers">PAG
computers</a>.
</p>

<p>
When you log in, you will encounter an error in your initial
<tt>.bashrc</tt> or <tt>.cshrc</tt> until you <a href="#local-cvs">check
out your copy of the CVS repository</a>.  (The error message will tell you
to perform the checkout.)
</p>


<h3><a name="getting-daikon"></a>Getting your copy of Daikon</h3>

<p>
(Note: when you first trying out Daikon, you can provide a valuable
perspective that we don't usually get:  we are so used to the system that
we don't even notice the annoying (or incorrect) aspects of the tools, and
the ambiguous, confusing, or missing parts of the documentation.  Please be
particularly vigilant when you start our so that you can make suggestions
for improving the tools, or come up with ideas that you might pursue
yourself.)
</p>

<p>
For work on the PAG machines, you should check out a copy of the system
from the CVS repository.  (This only needs to be done once, though you must
periodically update your copy via <tt>cvs update</tt>.)
Alternately, you can always download and install
Daikon from its .tar.gz distribution.
</p>

<p>
Checking out Daikon from the CVS repository has several advantages:
<ul>
  <li>You will have access to a number of files intended for developer use
      which are not present in the distribution.
  <li>It is very easy to update to the latest version of the software,
      retaining any personal customizations you have made.
  <li>You can make changes and incorporate them in the master version of
      Daikon.
</ul></p>

<p>
There are two modules (directories) available via anonymous CVS from
pag.csail.mit.edu:  <tt>invariants</tt> (the bulk of the Daikon invariant
detection system, which is written in Java) and <tt>dfej</tt> (the Daikon
front end for Java, which is written in C++).
</p>

<p>
You can learn how to use CVS from
<a href="https://www.cvshome.org/new_users.html">CVS for new
users</a>, or the <a href="http://www.gnu.org/software/cvs/manual/">CVS
manual</a> (<a
href="https://www.cvshome.org/docs/manual/index.html">alternate site</a>).
</p>

<h4><a name="local-cvs"></a>Local CVS</h4>

<p>
The following commands create and populate the
<tt>~/research/invariants</tt> directory:
<pre>
    mkdir ~/research
    cd ~/research
    fs sa -d . .. -a pag-admin rl
    fs sa -d . .. -a pag rl
    cvs -d $pag/projects/invariants/.CVS co invariants
    cd invariants
    cp -p doc/www/mit/Makefile.user java/
    cd ~/research/invariants
    make compile
</pre>
</p>

<p>
Before trying to compile (via <tt>make</tt> in any directory under
<tt>$inv/java</tt>), log out and log back in, to set up your environment.
</p>

<p>
Optionally, you may check out a copy of the <tt>dfej</tt> directory.
You should not need to do this, however; just use the executable in
<tt>/home/httpd/html/pag/daikon/download/binaries/mit</tt>, which should
already be on your path.  If you do check out the <tt>dfej</tt> directory,
use this command:
<pre>
    cd ~/research/invariants
    cvs -d $pag/projects/invariants/.CVS co dfej
    cd dfej
    ./configure
</pre>

<p>
You may also want the <tt>papers</tt> directory:
<pre>
    cd ~/research/invariants
    cvs -d $pag/projects/invariants/.CVS co papers
</pre>

<p>
If you want to instrument C programs, get Kvasir:
<pre>
    cd ~/research/invariants
    make build-kvasir
</pre>
</p>


<h4><a name="remote-cvs"></a>Remote CVS</h4>

<p>
You can also create your copy of the repository on a remote machine (that
is, not a PAG client machine).  You can do so using regular CVS or
anonymous CVS.
<ul>
  <li><a href="../anoncvs.html">Anonymous CVS instructions</a>
</ul>
</p>

<p>
If you use regular remote CVS, you will need to set up your environment
properly on the remote machine.
(You don't have to worry about this step when using a local CVS checkout on
the CSAIL machines.)
For example, you will want to copy over your dotfiles or at least copy the
contents of the dotfiles in <tt>$inv/doc/www/mit/</tt> (at a minimum,
<tt>.bashrc</tt> or <tt>.cshrc</tt>) to your remote machine, and you may
need to adjust some of their settings (such as the ones that refer to the
PAG filesystem).  Also ensure that you set the CVS_RSH environment variable
to "ssh" (without the quotes).
</p>

<p>
The command to check out the repository using regular remote CVS is:
<pre>
cvs -d :ext:<i>username</i>@pag.csail.mit.edu:/afs/csail.mit.edu/group/pag/projects/invariants/.CVS co invariants
</pre>
Other modules (such as dfej) can be obtained by replacing the final
<tt>invariants</tt> with another module name.
</p>

<p>
You may also need to install various extra packages, such as Simplify.
See the manual for details.
</p>

<p>
If you use Kerberos authentication on the remote machine, then you do not
have to type your password every time that you perform a CVS operation.
</p>


<h4><a name="using-cvs"></a>Using CVS</h4>

<p>
CVS permits multiple people to simultaneously edit (their own copy of) a
set of files, then merge the changes.  See the CVS manual to learn more.
The key commands are:
<dl>
  <dt><tt>cvs update -d</tt>
  <dd>update your version of the files from the repository
  <dt><tt>cvs diff</tt>
  <dd>show difference between your version and the repository (at the time
      you last updated)
  <dt><tt>cvs add <i>FILENAME ...</i></tt>
  <dd>add a file to the repository (you must also commit it)
  <dt><tt>cvs commit <i>[FILENAME ...]</i></tt>
  <dd>put your version of the file in the repository; don't forget to
      include a descriptive message regarding what changed
</dl>
I find it much easier to perform CVS manipulations in Emacs.  First, put
<tt>(autoload 'cvs-update "pcl-cvs" nil t)</tt> in your <tt>.emacs</tt> file.
Then, you can do <tt>M-x cvs-update</tt> to get a Dired-like listing of
(changed) files in the directory.  As with any Emacs mode, do
<tt>C-h m</tt> (help on mode) for details about how to use CVS mode in
Emacs.</p>

<p>
You should do <tt>cvs update</tt> frequently, in order to avoid conflicts
(where someone else has changed something that you have also changed).
Please commit your changes fairly regularly, too, so that others can take
advantage of your changes.  But always test your changes, never commit
changes unless the regression tests pass, and use a descriptive CVS comment
when you commit.
</p>


<h3><a name="environment"></a>Notes on your environment</h3>

<p>
By default, your account uses bash as its shell.  To use another shell, run
the <tt>chsh</tt> command (for instance, <tt>chsh -s /bin/tcsh</tt>), then log
out and log back in.
</p>

<p>
If you wish to use the Eclipse IDE, see the <a
href="eclipse-pag.html">instructions for using Eclipse at PAG</a>.
</p>

<p>
In order to permit other members of the Daikon project to read your files,
please make them readable by the <tt>pag</tt> group, as described on the <a
href="http://pag.csail.mit.edu/pag/logistics.html#pag-computers">PAG
computers</a>.
</p>

<!--
In order to permit other members of the Daikon project to read your files,
you should either make them world-readable, or place them in the
<tt>invariants</tt> group and make them group-readable.  You may or may not
need to re-run the following commands periodically to ensure that new files
are readable, depending on how your environment and editor are set up.
<blockquote>
<pre>
## <em>Do one of the following for each directory the group should be able to read</em>
# <em>To make a directory world-readable:</em>
chmod -R +rx <em>DIR</em>
# <em>To make a directory group-readable, run two commands:</em>
chmod -R g+rx <em>DIR</em>
chgrp -R invariants <em>DIR</em>
</pre>
</blockquote>
<p>
-->

<p>
A few other environment details:
<ul>
  <li>Make sure that all the files in <tt>invariants/scripts</tt> are
      executable:
<pre>
	chmod a+x invariants/scripts/*
</pre>
      (If everything is set up properly, they should be executable already
      when you check them out from the CVS repository.)
  <li>You can receive an email notification whenever files (in particular
      directories of your choosing) are checked in.  To receive such
      notifications, edit
      <tt>$pag/projects/invariants/.CVS/CVSROOT/loginfo</tt>.  This file is
      under RCS control; in Emacs, do <tt>C-x C-q</tt> before editing it
      and again after editing it.  Note that some of the lists of email
      addresses are space-separated and others are comma-separated; be
      careful to use the proper separator.
</ul>
</p>

<p>
Feel free to look at other people's dotfiles, such as
<tt>~<em>USER</em>/.cshrc</tt> and <tt>~<em>USER</em>/.emacs</tt>, for
potential customizations (but don't go overboard by copying everything you
find without understanding it).</p>


<h2><a name="running-daikon"></a>Running Daikon</h2>

<p>
See the <a href="../download/doc/">Daikon manual</a> for instructions.
</p>

<h2><a name="scratch-directories"></a>Large files and scratch directories</h2>

<p>
To avoid filling up our disks with very large files (and to avoid causing
backups to be made of those large files), avoid creating dtrace files in
your home directory; instead, use a temporary directory.  Each pag client
machine has two such directories:  /scratch and /scratch2.  These
directories are quite large (dozens of gigabytes) and are not backed up.
The pag machines allow cross-mounting of /scratch and /scratch2 from other
machines:
<pre>
  cd /var/autofs/net/<em>pag-client</em>/scratch
  cd /var/autofs/net/<em>pag-client</em>/scratch2
</pre>
Typically each group member creates a subdirectory called
<tt>/scratch/$USER/</tt> on some machine.
</p>

<p>
To ensure that dtrace files are created on one of the scratch drives, you
can specify an absolute pathname for the trace file, or you can run your
experiments in a scratch directory, or you can use the makefiles in the
$inv/tests/ directory, which automatically put dtrace files on scratch
drives.  Another advantage of using the makefiles is that it is easy to set
up and ensures that all the required steps are performed in the proper
order, in an easily reproducible way.
</p>

<p>
You should almost specify a trace file name that includes <tt>.gz</tt> at the end;
see the <tt>--dtrace-file=FILENAME</tt> argument to dfej, or the DTRACEFILE
environment variable.  (This is the default if you don't specify a filename.)
</p>


<h2><a name="editing-daikon">Editing Daikon source code</a></h2>

<p>
Important:  see the <a
href="http://pag.csail.mit.edu/pag/logistics.html#code-conventions">PAG
coding conventions</a>.
</p>

<h3><a name="Emacs-commands">Emacs commands</a></h3>

<p>
The command <tt>M-x daikon-tags-table</tt> sets up Emacs to use the Daikon
TAGS table, which lets you easily find definitions and search through the
entire codebase in Emacs.  (You need to run this command once per instance
of Emacs.)
</p>

<p>
The commands <tt>M-x daikon-info</tt> and <tt>M-x
daikon-developer-info</tt> view the Daikon manual and the Daikon Developer
manual using the Info
viewer within Emacs.  These commands also update all other versions of the
manuals (HTML, PDF, etc.).
You may also choose to use the stand-alone Info viewer, to
use a Web browser to read the manual in HTML form, or to read the
PostScript or PDF version either electronically or on paper.
</p>


<!-- No <tt>...</tt> around "daikon.texinfo" due to bad HTML rendering. -->
<h3><a name="editing-daikon.texinfo"></a>Editing daikon.texinfo</h3>

<p>
The Daikon manual appears in <tt>doc/daikon.texinfo</tt>.  The manual is
written using the Texinfo formatting system, which makes it easy to produce
HTML, info, or printed (PostScript and PDF) output.
</p>

<p>
You can edit the manual using an ordinary text editor.  You can either
mimic the formatting commands that already appear in the manual or read the
<a href="http://texinfo.org">Texinfo documentation</a>.
</p>

<p>
If you wish to create a new section of the manual, insert two lines like
the following:
<blockquote>
<pre>
@node    <em>Short title</em>, Foo, Bar, Baz
@<em>chapter</em> <em>Long title</em>
</pre>
</blockquote>
where you should insert "Foo, Bar, Baz" literally (they will be fixed up
for you automatically), you select the short and the long titles (which may
even be the same), and you may replace "@chapter" by "@section",
"@subsection", or "@subsubsection".
</p>

<p>
Once you have edited the manual, run <tt>make</tt> twice (yes, you must run
it twice) in order to generate formatted versions of the manual
(<tt>daikon.</tt>{<tt>html,info,ps,pdf</tt>}).
</p>


<h2><a name="other-tasks">Other tasks</a></h2>


<h3><a name="regression-tests">Testing Daikon</a></h3>

<p>
See the description of <a
href="http://www.pag.csail.mit.edu/daikon/download/doc/developer.html#Testing">Daikon's
tests</a> in the Daikon Developer Manual.  It is important that you
understand that Daikon has two sets of tests (unit tests and regression
tests), and that if any of these tests fails, you should not check in your
changes.
</p>

<p>
The regression tests run every night.  They should never fail, because it
is each developer's responsibility to run them before checking in code.  If
they do fail, then it is the responsibility of everyone who checked in code
in the previous day to collectively determine responsibility (this is often
obvious).  You can find out who has checked in since a given date with the
<tt>cvs history</tt> command:
<pre>
  cvs history -a -c -D "2005/03/08"
</pre>
</p>

<p>
It is the responsibility of the person who caused the failure to
fix it immediately; the regression tests should almost never fail two
nights in a row.  This is important to avoid masking subsequent errors
&mdash; the regression tests do no good while they are failing.  (And, you
should be ashamed if the regression tests fail at all!)
</p>


<h3><a name="distribution">Making a distribution</a></h3>

<p>
To publish a Daikon distribution, do the following.  If you only want to
create the <tt>daikon.tar</tt> or <tt>daikon.tar.gz</tt> file in your own
directory, then simply run <tt>make</tt> with the desired file as the
target.
</p>

<ol>

    <li> It is suggested that you use the <tt>daikonuser</tt> account to
    publish a distribution.  This ensures that everything has been committed
    to CVS and that nothing extraneous in your account gets included in the
    distribution.  Ask a senior group member for the password.  Note that all of
    the following instructions should work from other accounts as
    well. </p>

    <pre>
        su - daikonuser
    </pre>

    <li> Update daikon in daikonuser to the most recent version. </p>

    <pre>
        cd $inv
        cvs -q update -d
        cvs -q diff
    </pre>

    The <tt>cvs -q diff</tt> command should produce no output.

    <li> Rebuild everything. </p>

    <pre>
        make -C $inv/java clean
        make -C $inv/java compile
        make -C $inv/doc
        make -C $inv/dfej
	make -C $inv kvasir
        make -C $inv/kvasir all install
    </pre> </p>

    <li> Run the kvasir regression tests <p>
    <pre>
        make -C $inv/tests/kvasir-tests
    </pre>

    <li> Run the regression tests.  These will use Chicory as the
    front end.  All of
    the diff files should be of zero size when this is complete.</p>

    <pre>
        make -C $inv/tests clean
        make -C $inv/tests diffs
    </pre> </p>

    (To run the tests using dfej, define DFEJ_EXECUTABLE to
    the dfej built above ($inv/dfej/src/dfej) and USE_DFEJ=1.)

    <li> Edit the <tt>doc/CHANGES</tt> file to indicate what has changed
    in this version.  A good way to determine what has changed is to diff
    the texinfo source files in the doc directory against the previous
    versions: </p>

    <pre>
        cd $inv/doc
        diff -b -u -s --from-file /afs/csail/group/pag/docroot/www.pag.csail.mit.edu/daikon/dist/doc *.texinfo
    </pre> <p>

    Another good source of information is to examine the cvs logs over the
    last month: </p>

    <pre>
	cd $inv/java
	cvs -q log -d "><em>2004-12-01</em>" -N | cvs-log-summarize.pl
    </pre>

    <li> Set the distribution date and version number.  The date will
    be set to today, but can be overridden by redefining environment
    variable TODAY (e.g., 'TODAY=November 1 2004').  The version is
    specified in the file $inv/doc/VERSION </p>

    <pre>
	cd $inv
	make update-doc-dist-date-and-version
    </pre>

    <li> Build everything to be distributed and copy it to the
    staging area ($inv/dist).  The final output will be a list
    of files that were added/removed since the last release.</p>

    <pre>
        make staging
    </pre>

    <li> Test the distribution in the staging area.  The last part of
    the test runs Chicory/Daikon on the StackAr example in the
    release.  Success is indicated by invariant output being written
    to the screen. <b>Consider moving the staging area to the website
    so that we can check things out via the webserver before
    installing.</b></p>

    <pre>
        make test-staged-dist
    </pre>

    <li> Update the website. </p>

    <pre>
        make staging-to-www
    </pre> </p>

    Note that <code>make staging-to-www</code> will automatically
    update the version numbers in the source code and documentation
    from the file <tt>doc/VERSION</tt>.  After doing so, it will
    correctly update the version number in <tt>doc/VERSION</tt>.  This
    should not require any hand intervention unless there is a problem
    near the end of building the distribution and the <code>make
    update-doc-dist-date-and-version </code> command has to be run
    again after the version number has been incremented.  In this
    case, simply edit <tt>doc/VERSION</tt> by hand back to the correct
    version number before rebuilding. </p>

    <b>We should consider just updating the version number by hand at the
    beginning of the process.  That way we can run this multiple times without
    confusion.</b> </p>

    <li> Check the website to see if it has any broken links </p>

    <pre>
      checklink.pl -q -r `cat $inv/scripts/checklink-args.txt` http://pag.csail.mit.edu/daikon
    </pre>

    <li> Commit any changes back to CVS </p>

    <pre>
        cd $inv
        cvs -q commit -m "Change version to &lt;X.Y.Z>"
    </pre> </p>

    <li> Copy the new version of dfej (if any) to the standard pag
    location </p>

    <pre>
      cp -pf $inv/dfej/src/dfej /afs/csail/group/pag/projects/invariants/binaries
    </pre> </p>

    <li> Send mail to the daikon-announce mailing list.  There are sample
    messages in the archive of daikon-announce
    (<a href=http://lists.csail.mit.edu/mailman/listinfo/daikon-announce>http://lists.csail.mit.edu/mailman/listinfo/daikon-announce</a>).

    <p>
    You may need to visit <a
    href="http://lists.csail.mit.edu/mailman/admindb/daikon-announce">http://lists.csail.mit.edu/mailman/admindb/daikon-announce</a>
    to approve the message before it is sent to the list.
    </p>

</ol> </p>



<h2><a name="reporting">Reporting on your research</a></h2>

<p>
The outcome of research -- whether at the UROP, M.Eng., or Ph.D. level --
should be a paper describing what was learned and disseminating that
knowledge for the benefit of other researchers and practitioners.  For
instance, a summer's work might result in a conference or workshop paper.
Please keep in mind where your results might be published and whether what
you are doing contributes to the state of knowledge (either directly or
indirectly).
</p>

<p>
Each week, each group member prepares a written progress report as a short
email message.  It only needs to be a couple paragraphs or a page long and
will probably only take 15-30 minutes to compose, but it should explain
what you have accomplished, what you have learned, and what you plan to do
next.  This is very helpful both in permitting others to understand what
you have done, and also in focusing your attention on whether you have been
productive and keeping you on top of your progress.
</p>

<p>
Each week, the Program Analysis Group meets to hear a more in-depth report
on the current status of one group member.  Each member presents during group
meeting every 2-3 months.  These presentations may be informal, but they
should be organized in a way that permits others to both understand and
critique the work.  The presentation may use handouts, overhead
transparencies, and/or a whiteboard.  Plan the presentation for 20-30
minutes; questions are likely to draw out the meeting to one hour, but we
will try to avoid meetings longer than that.
</p>


<hr>
<a href="../">Daikon invariant detector</a></p>

<address>
  <a href="http://pag.csail.mit.edu/~mernst/">Michael Ernst</a>
</address>

</body>
</html>

<!--  LocalWords:  TSE cshrc yourusername cvsrc dfej LD csh setenv dfec jre cwd
 -->
<!--  LocalWords:  CLASSPATH Classpath RTJAR ARGV cvs gz mkdir cd chmod rx cp
 -->
<!--  LocalWords:  chgrp inv dotfiles filesystem autoload pcl Dired chsh javac
 -->
<!--  LocalWords:  Jikes jikes dtrace DTRACEFILE Baz html ps pdf
 -->
<!--  LocalWords:  daikongroupmember tarfile jdoc whiteboard texinfo pp fs sa
 -->
<!--  LocalWords:  pag admin rl co java kvasir ssh daikon diff IDE DIR Foo dist
 -->
<!--  LocalWords:  subsubsection daikonuser webserver
 -->
